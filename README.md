# Auto Grading System (è‡ªåŠ¨é˜…å·ç³»ç»Ÿ)

è¿™æ˜¯ä¸€ä¸ªåŸºäº C è¯­è¨€æ ¸å¿ƒé€»è¾‘å’Œ Python Flask Web ç•Œé¢çš„è‡ªåŠ¨é˜…å·ç³»ç»Ÿã€‚æ”¯æŒå‘½ä»¤è¡Œ (CLI) å’Œ Web ä¸¤ç§äº¤äº’æ–¹å¼ã€‚

## ğŸš€ æœ€æ–°ä¼˜åŒ– (v2.2) - å¼‚æ­¥æ¶æ„å‡çº§

*   âš¡ **å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—**ï¼šå¼•å…¥ **Celery + Redis** æ¶æ„ï¼Œå°†è€—æ—¶çš„é˜…å·ä»»åŠ¡ï¼ˆç‰¹åˆ«æ˜¯æ‰¹é‡é˜…å·ï¼‰ä» Web ä¸»çº¿ç¨‹å‰¥ç¦»ï¼Œå¤§å¹…æå‡ Web å“åº”é€Ÿåº¦å’Œååé‡ã€‚
*   ï¿½ **å®æ—¶ WebSocket åé¦ˆ**ï¼šå¼•å…¥ **Flask-SocketIO**ï¼Œåœ¨åå°é˜…å·è¿‡ç¨‹ä¸­å®æ—¶å‘å‰ç«¯æ¨é€è¿›åº¦æ›´æ–°ï¼Œæ— éœ€è½®è¯¢ï¼Œä½“éªŒæ›´åŠ æµç•…ã€‚
*   ï¿½ğŸ”„ **Redis ç¼“å­˜åŠ é€Ÿ**ï¼šä¸ä»…ä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ— Brokerï¼Œè¿˜æ¥ç®¡äº† Flask Session å­˜å‚¨ï¼Œå¹¶ç¼“å­˜é«˜é¢‘è®¿é—®çš„ä»ªè¡¨ç›˜ç»Ÿè®¡æ•°æ®ï¼Œå‡å°‘æ•°æ®åº“å‹åŠ›ã€‚
*   ğŸ‹ **å…¨æ ˆå®¹å™¨åŒ–**ï¼šæ–°å¢ `worker` (Celery) å’Œ `redis` å®¹å™¨ï¼Œç°åœ¨ `docker-compose` ä¸€é”®æ‹‰èµ· 5 ä¸ªå¾®æœåŠ¡ (Web, DB, Redis, Worker, Tunnel)ã€‚
*   ğŸ—„ï¸ **ä¼ä¸šçº§æ•°æ®åº“**ï¼šç›®å‰é»˜è®¤æ”¯æŒ **PostgreSQL**ï¼Œæ”¯æŒé«˜å¹¶å‘è¯»å†™ï¼Œå½»åº•è§£å†³ SQLite çš„é”ç«äº‰é—®é¢˜ã€‚
*   ğŸ› ï¸ **æ™ºèƒ½è¿ç§»**ï¼šæä¾› `migrate_to_postgres.py` è„šæœ¬ï¼Œæ”¯æŒä»æ—§ç‰ˆ SQLite æ— ç¼è¿ç§»æ•°æ®åˆ° PostgreSQLã€‚
*   ğŸ›¡ï¸ **å®‰å…¨æ€§å¢å¼º**ï¼šå…¨ç«™å¯ç”¨ CSRF é˜²æŠ¤ï¼Œç¡®ä¿è¡¨å•æäº¤å®‰å…¨ã€‚
*   ğŸ“¦ **ç¦»çº¿æ”¯æŒ**ï¼šBootstrap 5 å’Œ Chart.js é™æ€èµ„æºæœ¬åœ°åŒ–ï¼Œæ— éœ€å¤–ç½‘å³å¯å®Œæ•´è¿è¡Œã€‚
*   ğŸ”„ **æ•°æ®åŒæ­¥**ï¼šWeb ç«¯é¢˜åº“ä¿®æ”¹ä¼šè‡ªåŠ¨åŒæ­¥åˆ° C è¯­è¨€æ ¸å¿ƒæ•°æ®æ–‡ä»¶ (`questions.txt`)ï¼Œç¡®ä¿åŒç«¯æ•°æ®ä¸€è‡´ã€‚
*   âš¡ **æ€§èƒ½æå‡**ï¼šå¯ç”¨ `-O2` ç¼–è¯‘ä¼˜åŒ–ï¼Œæ•°æ®åº“å­—æ®µå¢åŠ ç´¢å¼•ï¼Œå¤§å¹…æå‡æŸ¥è¯¢ä¸é˜…å·é€Ÿåº¦ã€‚

## é¡¹ç›®ç‰¹æ€§

*   **åŒæ¨¡å¼äº¤äº’**ï¼š
    *   **CLI æ¨¡å¼**ï¼š
        *   ç»å…¸çš„å‘½ä»¤è¡Œäº¤äº’ï¼Œæ”¯æŒ Windows/Linuxã€‚
        *   **å…¨æ–°å½©è‰² UI**ï¼šå¼•å…¥ ANSI é¢œè‰²æ”¯æŒï¼Œç•Œé¢æ›´ç¾è§‚æ¸…æ™°ã€‚
        *   **å¯è§†åŒ–è¿›åº¦æ¡**ï¼šè€ƒè¯•è¿‡ç¨‹ä¸­å®æ—¶æ˜¾ç¤ºç­”é¢˜è¿›åº¦ã€‚
        *   **å†å²è®°å½•å›¾è¡¨**ï¼šåœ¨ç»ˆç«¯å†…ç›´æ¥ç»˜åˆ¶ ASCII æŸ±çŠ¶å›¾ï¼Œå±•ç¤ºå†å²æˆç»©è¶‹åŠ¿ã€‚
    *   **Web æ¨¡å¼**ï¼š
        *   **ç”¨æˆ·ç³»ç»Ÿ**ï¼šå®Œæ•´çš„æ³¨å†Œ/ç™»å½•æµç¨‹ï¼ŒåŒºåˆ†ç®¡ç†å‘˜ä¸å­¦ç”Ÿæƒé™ã€‚
        *   **æ•°æ®ä»ªè¡¨ç›˜**ï¼šå¯è§†åŒ–å±•ç¤ºæˆç»©è¶‹åŠ¿ä¸é”™é¢˜åˆ†æã€‚
        *   **ç°ä»£åŒ–ç•Œé¢**ï¼šåŸºäº Bootstrap 5 çš„å“åº”å¼è®¾è®¡ã€‚
        *   **è€ƒè¯•å®‰å…¨**ï¼šè€ƒè¯•æ¨¡å¼é”å®šã€é˜²åé€€ã€é˜²æ„å¤–åˆ·æ–°ã€‚
*   **æ™ºèƒ½è¯„åˆ†**ï¼š
    *   å¼•å…¥ **Levenshtein ç¼–è¾‘è·ç¦»ç®—æ³•**ï¼Œæ”¯æŒæ¨¡ç³ŠåŒ¹é…ã€‚
    *   ä¸å†è¦æ±‚ç­”æ¡ˆå®Œå…¨ä¸€è‡´ï¼Œå…è®¸ä¸€å®šç¨‹åº¦çš„é”™åˆ«å­—ï¼ˆå¦‚ "Hello" ä¸ "Hllo"ï¼‰ï¼Œè¯„åˆ†æ›´åŠ äººæ€§åŒ–ã€‚
*   **æ··åˆç¼–ç¨‹**ï¼š
    *   æ ¸å¿ƒé˜…å·é€»è¾‘ (`grading.c`) ç”± C è¯­è¨€ç¼–å†™ï¼Œç¼–è¯‘ä¸ºåŠ¨æ€é“¾æ¥åº“ (`.dll`/`.so`)ã€‚
    *   Web å±‚ç”± Python Flask å®ç°ï¼Œé€šè¿‡ `ctypes` è°ƒç”¨ C è¯­è¨€æ ¸å¿ƒåº“ã€‚

## ç›®å½•ç»“æ„

```text
auto-grading-system/
â”œâ”€â”€ build/                # ç¼–è¯‘äº§ç‰© (å¯æ‰§è¡Œæ–‡ä»¶å’ŒåŠ¨æ€åº“)
â”œâ”€â”€ include/              # C å¤´æ–‡ä»¶
â”œâ”€â”€ src/                  # C æºæ–‡ä»¶
â”œâ”€â”€ web/                  # Python Web æºä»£ç 
â”‚   â”œâ”€â”€ instance/         # æ•°æ®åº“æ–‡ä»¶ (data.db)
â”‚   â”œâ”€â”€ static/           # é™æ€èµ„æº (css/, js/, uploads/)
â”‚   â”œâ”€â”€ templates/        # HTML æ¨¡æ¿
â”‚   â”œâ”€â”€ utils/            # å·¥å…·æ¨¡å—
â”‚   â”œâ”€â”€ models.py         # æ•°æ®åº“æ¨¡å‹
â”‚   â”œâ”€â”€ app.py            # Flask ä¸»ç¨‹åº
â”‚   â””â”€â”€ config.py         # é¡¹ç›®é…ç½®
â”œâ”€â”€ Makefile              # æ„å»ºè„šæœ¬
â”œâ”€â”€ scripts/              # éƒ¨ç½²è„šæœ¬ç›®å½•
â”‚   â”œâ”€â”€ init_env.bat      # ç¯å¢ƒåˆå§‹åŒ–è„šæœ¬ (å†…éƒ¨ä½¿ç”¨)
â”‚   â”œâ”€â”€ deploy_local.bat  # æœ¬åœ°éƒ¨ç½²/å¼€å‘è„šæœ¬
â”‚   â””â”€â”€ deploy_public.bat # å…¬ç½‘éƒ¨ç½²/ç”Ÿäº§è„šæœ¬
â”œâ”€â”€ web/
â”‚   â”œâ”€â”€ app.py            # Web åº”ç”¨ä¸»ç¨‹åº
â”‚   â””â”€â”€ wsgi.py           # ç”Ÿäº§ç¯å¢ƒå…¥å£
â””â”€â”€ README.md             # é¡¹ç›®è¯´æ˜
```

## å¿«é€Ÿå¼€å§‹

### Docker å®¹å™¨åŒ–éƒ¨ç½² (Recommended)

è¿™æ˜¯æœ€ç¨³å®šã€ç¯å¢ƒæœ€ä¸€è‡´çš„è¿è¡Œæ–¹å¼ï¼Œä¹Ÿæ˜¯ç›®å‰**å”¯ä¸€æ¨è**çš„ç”Ÿäº§çº§éƒ¨ç½²æ–¹å¼ã€‚

1.  **å¯åŠ¨æœåŠ¡**:
    åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰“å¼€ç»ˆç«¯ï¼Œè¿è¡Œï¼š
    ```powershell
    docker-compose up -d --build
    ```
    ç³»ç»Ÿä¼šè‡ªåŠ¨é€šè¿‡ Docker Compose æ‹‰èµ·ä»¥ä¸‹æœåŠ¡ï¼š
    *   **web**: Python Flask åº”ç”¨ (Waitress server)
    *   **db**: PostgreSQL 15 æ•°æ®åº“
    *   **redis**: Redis 7.0 (ç¼“å­˜ä¸æ¶ˆæ¯é˜Ÿåˆ—)
    *   **worker**: Celery Worker (åå°å¼‚æ­¥é˜…å·è¿›ç¨‹)
    *   **tunnel**: Cloudflare Tunnel (å†…ç½‘ç©¿é€ HTTP2åè®®)

2.  **è®¿é—®åº”ç”¨**:
    *   **å†…ç½‘**: [http://localhost:8080](http://localhost:8080)
    *   **å¤–ç½‘**: è®¿é—®æ‚¨åœ¨ Cloudflare Dashboard é…ç½®çš„åŸŸå (éœ€é…ç½® `tunnel_token.txt`)ã€‚
    *   é»˜è®¤ç®¡ç†å‘˜è´¦å·: `admin` / `admin123`

**ğŸŒ å¦‚ä½•é…ç½® Cloudflare Tunnel (å¤–ç½‘è®¿é—®)**

ä¸ºäº†è·å¾—ç¨³å®šçš„å…¬ç½‘è®¿é—®åœ°å€ï¼Œå¹¶é…åˆ Docker éƒ¨ç½²ä½¿ç”¨ï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ“ä½œã€‚

**âš ï¸ é‡è¦æç¤º**ï¼šDocker å®¹å™¨å†…çš„éš§é“æœåŠ¡é»˜è®¤å·²é…ç½® `--protocol http2` å‚æ•°ï¼Œå¯è‡ªåŠ¨ç»•è¿‡ UDP/QUIC å±è”½ã€‚

1.  **å‡†å¤‡ Token**:
    *   ç™»å½• [Cloudflare Zero Trust Dashboard](https://one.dash.cloudflare.com/)ã€‚
    *   è½¬åˆ° **Networks > Tunnels**ï¼Œç‚¹å‡» **Create a tunnel**ã€‚
    *   é€‰æ‹© **Cloudflared** è¿æ¥å™¨ç±»å‹ã€‚
    *   åœ¨ "Install and run a connector" é¡µé¢ï¼Œ**å¤åˆ¶ `--token` åé¢çš„é‚£ä¸²é•¿å­—ç¬¦**ã€‚
    *   é…ç½® **Public Hostname** (Service: `HTTP` : `web:8080`)ã€‚*æ³¨æ„ï¼šåœ¨ Docker å†…éƒ¨ï¼ŒWeb æœåŠ¡çš„ä¸»æœºåæ˜¯ `web` è€Œä¸æ˜¯ `localhost`ã€‚*

2.  **åˆ›å»ºé…ç½®æ–‡ä»¶**:
    *   åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º **`tunnel_token.txt`** çš„æ–‡ä»¶ã€‚
    *   å°† token **ç²˜è´´**è¿›å» (æ–‡ä»¶ä¸­åªä¿ç•™è¿™ä¸€è¡Œ token å­—ç¬¦ä¸²)ã€‚

3.  **å¯åŠ¨éš§é“**:
    *   æ— éœ€ä»»ä½•é¢å¤–æ“ä½œã€‚åªè¦ `tunnel_token.txt` å­˜åœ¨ï¼Œå†æ¬¡è¿è¡Œ `docker-compose up -d --build`ï¼Œéš§é“å®¹å™¨å°±ä¼šè‡ªåŠ¨å¯åŠ¨ã€‚
    *   æ‚¨å¯ä»¥é€šè¿‡ `docker logs auto-grading-system-tunnel-1` æŸ¥çœ‹éš§é“è¿æ¥çŠ¶æ€ã€‚
    *   ä½¿ç”¨ `docker logs auto-grading-system-tunnel-1` æŸ¥çœ‹è¿æ¥æ—¥å¿—ã€‚

## ç”¨æˆ·æŒ‡å— (Web ç‰ˆ)

### ğŸ“ å­¦ç”Ÿç”¨æˆ·
1.  **æ³¨å†Œ/ç™»å½•**ï¼šè®¿é—®é¦–é¡µï¼Œç‚¹å‡»å³ä¸Šè§’â€œæ³¨å†Œâ€åˆ›å»ºè´¦å·ã€‚
2.  **å¼€å§‹è€ƒè¯•**ï¼š
    *   ç‚¹å‡»å¯¼èˆªæ çš„â€œå¼€å§‹è€ƒè¯•â€ã€‚
    *   ç³»ç»Ÿä¼šéšæœºæŠ½å–é¢˜ç›®ã€‚
    *   ç­”é¢˜è¿‡ç¨‹ä¸­è¯·å‹¿åˆ·æ–°é¡µé¢ï¼Œå¦åˆ™è¿›åº¦å¯èƒ½ä¸¢å¤±ã€‚
3.  **æŸ¥çœ‹æˆç»©**ï¼š
    *   æäº¤è¯•å·åï¼Œç³»ç»Ÿä¼šç«‹å³åˆ¤åˆ†å¹¶æ˜¾ç¤ºè¯¦ç»†æŠ¥å‘Šã€‚
    *   æŠ¥å‘Šä¸­åŒ…å«ï¼šæ€»åˆ†ã€ç”¨æ—¶ã€æ¯é“é¢˜çš„å¾—åˆ†ä¸æ ‡å‡†ç­”æ¡ˆå¯¹æ¯”ã€‚
4.  **ä»ªè¡¨ç›˜**ï¼š
    *   é¦–é¡µä»ªè¡¨ç›˜å±•ç¤ºæ‚¨çš„å†å²æˆç»©è¶‹åŠ¿å›¾ã€‚
    *   â€œé”™é¢˜åˆ†æâ€æ¨¡å—ä¼šåˆ—å‡ºæ‚¨æœ€å¸¸å‡ºé”™çš„é¢˜ç›®ï¼ŒåŠ©æ‚¨æŸ¥æ¼è¡¥ç¼ºã€‚

### ğŸ‘‘ ç®¡ç†å‘˜ç”¨æˆ·
1.  **è·å–æƒé™**ï¼š
    *   ç›®å‰éœ€æ‰‹åŠ¨ä¿®æ”¹æ•°æ®åº“ã€‚ä½¿ç”¨ SQLite å·¥å…·æ‰“å¼€ `web/instance/data.db`ã€‚
    *   æ‰¾åˆ° `user` è¡¨ï¼Œå°†ç›®æ ‡ç”¨æˆ·çš„ `is_admin` å­—æ®µè®¾ç½®ä¸º `1` (True)ã€‚
2.  **é¢˜åº“ç®¡ç†**ï¼š
    *   ç™»å½•åï¼Œå¯¼èˆªæ ä¼šå‡ºç°â€œé¢˜åº“ç®¡ç†â€å…¥å£ã€‚
    *   **æ·»åŠ é¢˜ç›®**ï¼šæ”¯æŒè¾“å…¥é¢˜ç›®å†…å®¹ã€æ ‡å‡†ç­”æ¡ˆã€åˆ†å€¼ï¼Œå¹¶å¯ä¸Šä¼ å›¾ç‰‡ã€‚
    *   **ç¼–è¾‘/åˆ é™¤**ï¼šå¯å¯¹ç°æœ‰é¢˜ç›®è¿›è¡Œä¿®æ”¹æˆ–åˆ é™¤ã€‚
3.  **æ•°æ®åŒæ­¥**ï¼š
    *   **è‡ªåŠ¨åŒæ­¥**ï¼šæ¯å½“æ‚¨åœ¨ Web ç«¯æ·»åŠ ã€ä¿®æ”¹æˆ–åˆ é™¤é¢˜ç›®æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å°†æœ€æ–°æ•°æ®å¯¼å‡ºåˆ° `questions.txt`ã€‚
    *   è¿™æ„å‘³ç€ CLI (å‘½ä»¤è¡Œ) ç‰ˆçš„é˜…å·ç¨‹åºä¹Ÿèƒ½å®æ—¶è·å–æœ€æ–°çš„é¢˜åº“æ•°æ®ã€‚

## ğŸ’» è¿ç»´ä¸é«˜çº§æ“ä½œæ‰‹å†Œ

æœ¬ç« èŠ‚ä»‹ç»äº†å¦‚ä½•æ‰‹åŠ¨ç®¡ç†é¡¹ç›®æœåŠ¡ï¼Œé€‚åˆå¼€å‘è€…æˆ–è¿ç»´äººå‘˜æŸ¥é˜…ã€‚æ‰€æœ‰å‘½ä»¤å‡å»ºè®®åœ¨ VS Code çš„ **PowerShell** ç»ˆç«¯ä¸­æ‰§è¡Œã€‚

### 1. ä¸€é”®ç»´æŠ¤å‘½ä»¤

| æ“ä½œç›®æ ‡ | å‘½ä»¤ | è¯´æ˜ |
| :--- | :--- | :--- |
| **Docker å¯åŠ¨/æ›´æ–°** | `docker-compose up -d --build` | **æ¨è**ã€‚è‡ªåŠ¨æ„å»ºå¹¶è¿è¡Œæ‰€æœ‰æœåŠ¡ã€‚ |
| **Docker é‡å¯åº”ç”¨** | `docker-compose restart web` | ä»…é‡å¯ Web å®¹å™¨ (å¸¸ç”¨äºæ•°æ®åº“è¿ç§»å)ã€‚ |
| **Docker åœæ­¢** | `docker-compose down` | åœæ­¢å¹¶ç§»é™¤æ‰€æœ‰å®¹å™¨ã€‚ |
| **å¯åŠ¨éš§é“** | `.\cloudflared.exe ...` | è§ä¸Šæ–‡è¯´æ˜ã€‚ |
| **(Legacy) è„šæœ¬å¯åŠ¨** | `.\scripts\deploy_public.ps1` | æ—§ç‰ˆä¸€é”®è„šæœ¬ã€‚ |

#### **é‡è¦æç¤º** 
å½“æ‚¨å¯¹ä»£ç è¿›è¡Œä¿®æ”¹å’Œç»´æŠ¤æ—¶ï¼Œå»ºè®®å…ˆåœæ­¢dockerï¼ˆè‡ªåŠ¨æ–­å¼€ç½‘ç»œè¿æ¥ï¼‰ï¼Œå®Œæˆä¿®æ”¹åå†é‡æ–°æ„å»ºå¹¶è¿è¡Œï¼š

1. å…ˆå½»åº•ç§»é™¤æ‰€æœ‰å®¹å™¨ï¼ˆå¯é€‰ï¼Œè¿™ä¼šè‡ªåŠ¨æ–­å¼€æ‰€æœ‰ç½‘ç»œè¿æ¥ï¼‰
`docker-compose down`

1. é‡æ–°æ„å»ºå¹¶å¯åŠ¨ï¼ˆ-d åå°è¿è¡Œï¼Œ--build ç¡®ä¿åº”ç”¨äº†æ–°çš„ä»£ç ä¿®æ”¹ï¼‰
`docker-compose up -d --build`


### 2. æ‰‹åŠ¨åˆ†æ­¥å¯åŠ¨ (Legacy / é Docker ç¯å¢ƒ)

å¦‚æœæ‚¨ä¸æƒ³ä½¿ç”¨ Docker ä¹Ÿä¸æƒ³ä½¿ç”¨è„šæœ¬ï¼Œå¯ä»¥æ‰‹åŠ¨åˆ†æ­¥å¯åŠ¨å„é¡¹ç»„ä»¶ï¼ˆä»…é€‚ç”¨äºæœ¬åœ°å¼€å‘ï¼‰ï¼š

**æ­¥éª¤ A: å¯åŠ¨ Web æœåŠ¡å™¨ (Waitress)**
```powershell
# 1. æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
.\.venv\Scripts\Activate

# 2. è®¾ç½® PYTHONPATH (é˜²æ­¢ ModuleNotFoundError)
$env:PYTHONPATH = "web"

# 3. å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨ (é»˜è®¤ç«¯å£ 8080)
python web/wsgi.py
```

**æ­¥éª¤ B: å¯åŠ¨ Cloudflare Tunnel**
ä¿æŒ Web æœåŠ¡å™¨è¿è¡Œï¼Œæ–°å»ºä¸€ä¸ªç»ˆç«¯çª—å£è¿è¡Œéš§é“ï¼š

*   **æ–¹å¼ 1 (Token æ¨¡å¼ - æ¨è)**:
    ```powershell
    # éœ€ç¡®ä¿æ ¹ç›®å½•ä¸‹æœ‰ verify_token.txt
    .\cloudflared.exe tunnel run --token (Get-Content tunnel_token.txt)
    ```
*   **æ–¹å¼ 2 (Name æ¨¡å¼ - éœ€æœ¬åœ°ç™»å½•)**:
    ```powershell
    # éœ€ç¡®ä¿æœ¬åœ°å·²é…ç½®åä¸º "Fishing-rod" çš„éš§é“
    .\cloudflared.exe tunnel run Fishing-rod
    ```

### 3. æ€§èƒ½è°ƒä¼˜è¯´æ˜

ä¸ºäº†åœ¨ä¸ªäººç”µè„‘ä¸Šè·å¾—æœ€ä½³å¹¶å‘æ€§èƒ½ï¼Œé¡¹ç›®å·²è¿›è¡Œä»¥ä¸‹é…ç½®ï¼š
*   **åŠ¨æ€å¹¶å‘**: `web/wsgi.py` ä¼šæ ¹æ®æ‚¨çš„ CPU æ ¸å¿ƒæ•°è‡ªåŠ¨è°ƒæ•´å·¥ä½œçº¿ç¨‹ (ç­–ç•¥: `CPUæ ¸æ•° * 2`ï¼Œä¸Šé™ 24)ã€‚
*   **å†…å­˜ä¿æŠ¤**: `web/utils/queue_manager.py` å†…ç½®è‡ªåŠ¨æ¸…ç†æœºåˆ¶ï¼Œå®šæœŸç§»é™¤é™ˆæ—§çš„ä»»åŠ¡è®°å½•ï¼Œé˜²æ­¢å†…å­˜æº¢å‡ºã€‚
*   **é«˜æ€§èƒ½ DB**: åˆ‡æ¢è‡³ **PostgreSQL** åï¼Œé…åˆè¿æ¥æ±  (SQLAlchemy Pool) å¯æ”¯æŒæ•°ç™¾äººåŒæ—¶åœ¨çº¿è€ƒè¯•ï¼Œæ— éœ€æ‹…å¿ƒ `database is locked` é”™è¯¯ã€‚

## ğŸ”„ æ•°æ®åº“è¿ç§»æŒ‡å— (Upgrade)

å¦‚æœæ‚¨æ˜¯ä» v2.0 (SQLite) å‡çº§ä¸Šæ¥çš„ç”¨æˆ·ï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿ç§»æ•°æ®ï¼š

1.  **å¯åŠ¨ Postgres å®¹å™¨** (å‚è€ƒ"å‰ç½®å‡†å¤‡")ã€‚
2.  **è¿è¡Œè¿ç§»è„šæœ¬**ï¼š
    ```powershell
    .\.venv\Scripts\Activate
    python scripts/migrate_to_postgres.py
    ```
3.  **æŒ‰æç¤ºæ“ä½œ**ï¼š
    *   è„šæœ¬ä¼šè‡ªåŠ¨æ£€æµ‹æœ¬åœ°çš„ `data.db` (SQLite)ã€‚
    *   å›è½¦ç¡®è®¤ Postgres è¿æ¥åœ°å€ (é»˜è®¤: `postgresql://postgres:postgres@localhost:5432/grading_system`)ã€‚
    *   è„šæœ¬ä¼šè‡ªåŠ¨åˆ›å»ºæ–°è¡¨å¹¶å°†ç”¨æˆ·ã€é¢˜ç›®ã€æˆç»©ç­‰æ•°æ®å¯¼å…¥ Postgresã€‚

## å¸¸è§é—®é¢˜

**Q: ä¸ºä»€ä¹ˆä¿®æ”¹äº†é¢˜ç›®ï¼ŒCLI ç‰ˆæ²¡æœ‰å˜åŒ–ï¼Ÿ**
A: è¯·ç¡®ä¿æ‚¨æ˜¯åœ¨ Web ç®¡ç†ç•Œé¢è¿›è¡Œçš„ä¿®æ”¹ã€‚ç³»ç»Ÿä¼šè‡ªåŠ¨è§¦å‘åŒæ­¥æœºåˆ¶ã€‚å¦‚æœæ‚¨æ˜¯ç›´æ¥ä¿®æ”¹æ•°æ®åº“æ–‡ä»¶ï¼Œåˆ™ä¸ä¼šè§¦å‘åŒæ­¥ã€‚

**Q: ç”Ÿäº§ç¯å¢ƒå¯åŠ¨æŠ¥é”™ "ModuleNotFoundError: No module named 'config'"ï¼Ÿ**
A: è¯·ç¡®ä¿ä½¿ç”¨ `deploy_public.bat` å¯åŠ¨ï¼Œæˆ–è€…ç›´æ¥è¿è¡Œ `python wsgi.py`ã€‚ä¸è¦ç›´æ¥è¿è¡Œ `python web/app.py` (è¿™æ˜¯å¼€å‘æ¨¡å¼)ã€‚

**Q: å¦‚ä½•æ”¯æŒæ›´å¤šäººåŒæ—¶è€ƒè¯•ï¼Ÿ**
A: å½“å‰é…ç½®é€‚åˆç­çº§å†…éƒ¨ä½¿ç”¨ã€‚å¦‚éœ€æ”¯æŒæ›´å¤§è§„æ¨¡å¹¶å‘ï¼ˆ>50äººï¼‰ï¼Œå»ºè®®ï¼š
1.  ç¡®ä¿å·²åˆ‡æ¢è‡³ PostgreSQL æ•°æ®åº“ (é»˜è®¤é…ç½®)ã€‚
2.  ä¿®æ”¹ `wsgi.py` ä¸­çš„ `threads` å‚æ•°ï¼Œå¢åŠ å·¥ä½œçº¿ç¨‹æ•°ã€‚
3.  å¦‚æœä½¿ç”¨ Docker éƒ¨ç½²ï¼Œé€‚å½“å¢åŠ å®¹å™¨çš„ CPU/å†…å­˜é™é¢ã€‚

## æ‰“åŒ…å‘å¸ƒ (Windows / Linux / macOS)

æœ¬ç³»ç»Ÿæ”¯æŒä½¿ç”¨ PyInstaller å°† Python Web ç«¯æ‰“åŒ…ä¸ºç‹¬ç«‹çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œæ–¹ä¾¿åœ¨æ²¡æœ‰ Python ç¯å¢ƒçš„ç”µè„‘ä¸Šè¿è¡Œã€‚

### 1. å‡†å¤‡å·¥ä½œ

ç¡®ä¿ä½ å·²ç»åˆ›å»ºäº†è™šæ‹Ÿç¯å¢ƒå¹¶å®‰è£…äº†æ‰€æœ‰ä¾èµ–ï¼ˆåŒ…æ‹¬ `pyinstaller`ï¼‰ï¼š

```bash
# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ (Windows)
.\.venv\Scripts\Activate

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ (Linux / macOS)
source .venv/bin/activate

# å®‰è£…ä¾èµ–
pip install -r web/requirements.txt
```

### âš ï¸ é‡è¦æç¤ºï¼šæ•°æ®å¤‡ä»½

**é‡æ–°æ‰“åŒ…ä¼šå®Œå…¨è¦†ç›– `dist/auto_grader_web` ç›®å½•ï¼**

å¦‚æœä½ ä¹‹å‰å·²ç»è¿è¡Œè¿‡æ‰“åŒ…åçš„ç¨‹åºï¼Œè¯·åœ¨é‡æ–°æ‰“åŒ…å‰**å¤‡ä»½ä»¥ä¸‹æ•°æ®**ï¼Œå¦åˆ™æ‰€æœ‰ç”¨æˆ·æ•°æ®ï¼ˆæ³¨å†Œä¿¡æ¯ã€è€ƒè¯•è®°å½•ã€ä¸Šä¼ å›¾ç‰‡ï¼‰éƒ½å°†ä¸¢å¤±ï¼š
1.  `dist/auto_grader_web/instance/data.db` (æ•°æ®åº“æ–‡ä»¶)
2.  `dist/auto_grader_web/uploads/` (å›¾ç‰‡æ–‡ä»¶å¤¹)

**å»ºè®®æµç¨‹**ï¼šå¤‡ä»½ä¸Šè¿°æ–‡ä»¶ -> è¿è¡Œæ‰“åŒ…å‘½ä»¤ -> å°†å¤‡ä»½æ–‡ä»¶è¦†ç›–å›åŸä½ã€‚

### 2. æ‰§è¡Œæ‰“åŒ…å‘½ä»¤

åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼ˆè¯·æ ¹æ®æ“ä½œç³»ç»Ÿé€‰æ‹©ï¼‰ï¼š

**Windows:**

```bash
pyinstaller --name auto_grader_web --onedir --add-data "web/templates;templates" --add-data "web/static;static" --add-binary "build/libgrading.dll;." --clean --noconfirm web/app.py
```

**Linux:**

```bash
pyinstaller --name auto_grader_web --onedir --add-data "web/templates:templates" --add-data "web/static:static" --add-binary "build/libgrading.so:." --clean --noconfirm web/app.py
```

**macOS:**

```bash
pyinstaller --name auto_grader_web --onedir --add-data "web/templates:templates" --add-data "web/static:static" --add-binary "build/libgrading.dylib:." --clean --noconfirm web/app.py
```

**å‚æ•°è¯´æ˜**ï¼š
*   `--onedir`: ç”Ÿæˆæ–‡ä»¶å¤¹æ¨¡å¼ (æ¨èï¼Œå¯åŠ¨å¿«ï¼Œæ˜“äºæ’æŸ¥é—®é¢˜)ã€‚
*   `--add-data`: æ‰“åŒ… HTML æ¨¡æ¿å’Œé™æ€èµ„æº (Windowsä½¿ç”¨ `;` åˆ†éš”ï¼ŒLinux/macOSä½¿ç”¨ `:` åˆ†éš”)ã€‚
*   `--add-binary`: æ‰“åŒ… C è¯­è¨€ç¼–è¯‘ç”Ÿæˆçš„åŠ¨æ€åº“ã€‚

### 3. è¿è¡Œç¨‹åº

æ‰“åŒ…å®Œæˆåï¼Œç”Ÿæˆçš„æ–‡ä»¶ä½äº `dist/auto_grader_web/` ç›®å½•ä¸‹ã€‚

1.  è¿›å…¥ `dist/auto_grader_web/` æ–‡ä»¶å¤¹ã€‚
2.  (å¯é€‰) å¦‚æœéœ€è¦è¿ç§»æ—§é¢˜åº“ï¼Œå°† `questions.txt` å¤åˆ¶åˆ°è¯¥æ–‡ä»¶å¤¹ä¸­ã€‚
3.  å¯åŠ¨ç¨‹åºï¼š
    *   **Windows**: åŒå‡» `auto_grader_web.exe`ã€‚
    *   **Linux / macOS**: åœ¨ç»ˆç«¯è¿è¡Œ `./auto_grader_web`ã€‚
4.  ç¨‹åºä¼šè‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨è®¿é—®ç³»ç»Ÿã€‚

**æ³¨æ„**ï¼š
*   æ‰“åŒ…åçš„ç¨‹åºæ•°æ®ï¼ˆæ•°æ®åº“ `instance/data.db`ã€ä¸Šä¼ çš„å›¾ç‰‡ `uploads/`ï¼‰ä¼šå­˜å‚¨åœ¨ç¨‹åºåŒçº§ç›®å½•ä¸‹ï¼Œæ–¹ä¾¿å¤‡ä»½å’Œè¿ç§»ã€‚

## å…¬ç½‘è®¿é—® (Ngrok)

å¦‚æœä½ æƒ³å°†æœ¬åœ°è¿è¡Œçš„ Web æœåŠ¡åˆ†äº«ç»™ä»–äººè®¿é—®ï¼Œå¯ä»¥ä½¿ç”¨ `ngrok`ã€‚

1.  **å®‰è£… Ngrok**: [ä¸‹è½½å¹¶æ³¨å†Œ](https://ngrok.com/)ã€‚
2.  **å¯åŠ¨æ˜ å°„**:
    ç¡®ä¿ä½ çš„ Flask åº”ç”¨æ­£åœ¨è¿è¡Œ (ç«¯å£ 5000)ï¼Œç„¶ååœ¨æ–°çš„ç»ˆç«¯çª—å£ä¸­è¿è¡Œï¼š
    ```bash
    ngrok http 5000
    ```
    *æç¤ºï¼šngrok å…è´¹ç‰ˆé¦–æ¬¡è®¿é—®å¯èƒ½ä¼šæ˜¾ç¤ºè­¦å‘Šé¡µï¼Œç‚¹å‡» "Visit Site" ç»§ç»­å³å¯ã€‚*

3.  **è·å–é“¾æ¥**:
    å¤åˆ¶ç»ˆç«¯æ˜¾ç¤ºçš„ `Forwarding` åœ°å€ (ä¾‹å¦‚ `https://xxxx-xxxx.ngrok-free.app`) å‘é€ç»™å…¶ä»–äººå³å¯è®¿é—®ä½ çš„è‡ªåŠ¨é˜…å·ç³»ç»Ÿã€‚

## å¼€å‘è¯´æ˜

*   **æ·»åŠ é¢˜ç›®**: å¯ä»¥åœ¨ Web ç•Œé¢æ·»åŠ ï¼ˆæ”¯æŒå›¾ç‰‡|åˆ†ç±»(å¯é€‰)å’Œå¤šè¡Œæ–‡æœ¬ï¼‰ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ç¼–è¾‘ `questions.txt`ã€‚
    *   æ ¼å¼: `é¢˜ç›®|ç­”æ¡ˆ|åˆ†å€¼|å›¾ç‰‡æ–‡ä»¶å(å¯é€‰)`
    *   æ³¨æ„ï¼šç›´æ¥ç¼–è¾‘æ–‡ä»¶æ—¶ï¼Œæ¢è¡Œç¬¦è¯·ä½¿ç”¨ `[NEWLINE]` ä»£æ›¿ã€‚
*   **ä¿®æ”¹æ ¸å¿ƒé€»è¾‘**: ä¿®æ”¹ `src/grading.c` åï¼Œå¿…é¡»é‡æ–°è¿è¡Œ `make` æ›´æ–°åŠ¨æ€åº“ã€‚
