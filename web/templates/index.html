{% extends "base.html" %}

{% block content %}
<div class="p-5 mb-4 bg-light rounded-3">
    <div class="container-fluid py-5">
        <h1 class="display-5 fw-bold">æ¬¢è¿ä½¿ç”¨è‡ªåŠ¨é˜…å·ç³»ç»Ÿ</h1>
        <p class="col-md-8 fs-4">æœ¬ç³»ç»Ÿé‡‡ç”¨ C è¯­è¨€ç¼–å†™æ ¸å¿ƒé˜…å·é€»è¾‘ï¼ŒPython Flask æä¾› Web äº¤äº’ç•Œé¢ã€‚</p>
        <div class="d-grid gap-2 d-md-flex justify-content-md-start">
            {% if current_user.is_authenticated %}
                <a href="/start_exam" class="btn btn-primary btn-lg px-4 me-md-2">å¼€å§‹è€ƒè¯•</a>
                {% if current_user.is_admin %}
                    <a href="/add" class="btn btn-outline-secondary btn-lg px-4">æ·»åŠ é¢˜ç›®</a>
                {% endif %}
            {% else %}
                <a href="{{ url_for('login') }}" class="btn btn-primary btn-lg px-4 me-md-2">ç™»å½•</a>
                <a href="{{ url_for('register') }}" class="btn btn-outline-secondary btn-lg px-4">æ³¨å†Œ</a>
            {% endif %}
        </div>
    </div>
</div>

{% if stats %}
<div class="row mb-4">
    <div class="col-md-4">
        <div class="card text-white bg-primary mb-3 h-100">
            <div class="card-header">é¢˜åº“æ€»é‡</div>
            <div class="card-body">
                <h1 class="card-title display-4">{{ stats.total_questions }}</h1>
                <p class="card-text">é“é¢˜ç›®</p>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card text-white bg-success mb-3 h-100">
            <div class="card-header">è€ƒè¯•æ€»æ¬¡æ•°</div>
            <div class="card-body">
                <h1 class="card-title display-4">{{ stats.total_exams }}</h1>
                <p class="card-text">æ¬¡è®°å½•</p>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card text-white bg-info mb-3 h-100">
            <div class="card-header">å¹³å‡å¾—åˆ†</div>
            <div class="card-body">
                <h1 class="card-title display-4">{{ stats.avg_score }}</h1>
                <p class="card-text">åˆ†</p>
            </div>
        </div>
    </div>
</div>
{% endif %}

{% if user_charts %}
<div class="row mb-4">
    <div class="col-md-6">
        <div class="card h-100">
            <div class="card-header fw-bold">ğŸ“ˆ è¿‘æœŸæˆç»©è¶‹åŠ¿ (æœ€è¿‘7æ¬¡)</div>
            <div class="card-body">
                <canvas id="trendChart"></canvas>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="card h-100">
            <div class="card-header fw-bold">âš ï¸ é«˜é¢‘é”™é¢˜ (Top 5)</div>
            <div class="card-body">
                <canvas id="errorChart"></canvas>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Trend Chart
        const trendCtx = document.getElementById('trendChart').getContext('2d');
        new Chart(trendCtx, {
            type: 'line',
            data: {
                labels: {{ user_charts.trend.labels | tojson }},
                datasets: [{
                    label: 'è€ƒè¯•å¾—åˆ†',
                    data: {{ user_charts.trend.data | tojson }},
                    borderColor: 'rgb(75, 192, 192)',
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    tension: 0.3,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });

        // Error Chart
        const errorCtx = document.getElementById('errorChart').getContext('2d');
        new Chart(errorCtx, {
            type: 'bar',
            data: {
                labels: {{ user_charts.errors.labels | tojson }},
                datasets: [{
                    label: 'é”™è¯¯æ¬¡æ•°',
                    data: {{ user_charts.errors.data | tojson }},
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.6)',
                        'rgba(54, 162, 235, 0.6)',
                        'rgba(255, 206, 86, 0.6)',
                        'rgba(75, 192, 192, 0.6)',
                        'rgba(153, 102, 255, 0.6)'
                    ],
                    borderColor: [
                        'rgba(255, 99, 132, 1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 206, 86, 1)',
                        'rgba(75, 192, 192, 1)',
                        'rgba(153, 102, 255, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                indexAxis: 'y', // Horizontal bar chart for better text readability
                scales: {
                    x: {
                        beginAtZero: true,
                        ticks: { stepSize: 1 }
                    }
                }
            }
        });
    });
</script>
{% endif %}

<div class="row align-items-md-stretch">
    <div class="col-md-12">
        <div class="h-100 p-5 bg-light border rounded-3">
            <h2>å…³äºæœ¬é¡¹ç›®</h2>
            <p>æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªè‡ªåŠ¨é˜…å·ç³»ç»Ÿçš„æ¼”ç¤ºï¼Œæ—¨åœ¨å±•ç¤º C è¯­è¨€ä¸ Python Web æ¡†æ¶çš„ç»“åˆã€‚</p>
            <hr>
            <h4>å¼€å‘è€…è”ç³»æ–¹å¼</h4>
            <ul class="list-unstyled">
                <li class="mb-2">
                    <strong>é‚®ç®±ï¼š</strong> 
                    <a href="mailto:huangmaidou608@outlook.com" class="text-decoration-none">huangmaidou608@outlook.com</a>
                </li>
                <li class="mb-2">
                    <strong>é¡¹ç›®ä»“åº“ï¼š</strong> 
                    <a href="https://github.com/pirate-608/auto-grading-system" target="_blank" class="text-decoration-none">https://github.com/pirate-608/auto-grading-system.git</a>
                </li>
            </ul>
            <a href="https://github.com/pirate-608/auto-grading-system" target="_blank" class="btn btn-dark">å‰å¾€ GitHub ä»“åº“</a>
        </div>
    </div>
</div>
{% endblock %}
