{% extends "base.html" %}

{% block content %}
<h2 class="mb-4">编辑题目</h2>
<form method="POST" action="{{ url_for('admin.edit_question', id=id) }}" enctype="multipart/form-data">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
    <div class="mb-3">
        <label for="content" class="form-label">题目描述</label>
        <textarea class="form-control" id="content" name="content" rows="5" required>{{ question.content }}</textarea>
        <div class="form-text">请不要包含 '|' 符号。支持多行输入。</div>
    </div>
    <div class="mb-3">
        <label for="image" class="form-label">题目图片 (可选)</label>
        {% if question.image %}
        <div class="mb-2">
            <img src="{{ url_for('main.uploaded_file', filename=question.image) }}" alt="Current Image" style="max-height: 200px; max-width: 100%;">
            <div class="form-check mt-2">
                <input class="form-check-input" type="checkbox" value="yes" id="delete_image" name="delete_image">
                <label class="form-check-label text-danger" for="delete_image">
                    删除当前图片
                </label>
            </div>
        </div>
        {% endif %}
        <input type="file" class="form-control" id="image" name="image" accept="image/*, .jpg, .jpeg, .png, .gif, .webp, .svg, .bmp, .tiff">
        <div class="form-text">上传新图片将替换旧图片。支持 JPG, PNG, GIF, WEBP, SVG, BMP, TIFF 等格式。</div>
    </div>
    <div class="mb-3">
        <label for="answer" class="form-label">标准答案</label>
        <input type="text" class="form-control" id="answer" name="answer" value="{{ question.answer }}" required>
        <div class="form-text">支持多个正确答案，请用分号 (;) 或中文分号 (；) 分隔。</div>
    </div>
    <div class="mb-3">
        <label for="score" class="form-label">分值</label>
        <input type="number" class="form-control" id="score" name="score" value="{{ question.score }}" required>
    </div>
    <div class="mb-3">
        <label for="category" class="form-label">题目集/分类</label>
        <input type="text" class="form-control" id="category" name="category" list="categoryList" value="{{ question.category }}" placeholder="例如：C语言基础">
        <datalist id="categoryList">
            {% for cat in categories %}
            <option value="{{ cat }}">
            {% endfor %}
        </datalist>
        </div>
        <div class="mb-3">
            <label for="type" class="form-label">题目类型</label>
            <select class="form-select" id="type" name="type">
                <option value="public" {% if question.type == 'public' %}selected{% endif %}>公共题目（请在个人主页查看权限）</option>
                <option value="personal" {% if question.type == 'personal' %}selected{% endif %}>个人题目</option>
            </select>
            <div class="form-text">个人题目仅自己可见和管理，公共题目所有人可见。</div>
    </div>
    <button type="submit" class="btn btn-primary">保存修改</button>
    <a href="/manage" class="btn btn-secondary">取消</a>
</form>
{% endblock %}
